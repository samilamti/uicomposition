@{
    ViewBag.Title = "Home Page";
}

<div class="jumbotron">
    <h1>Policy creation guide</h1>
    <p class="lead">This wizard will guide you through creating a policy</p>
    <p class="lead">- it's easy as 1-2-3!</p>
</div>

<div class="row">
    <div class="col-md-4">
        <div class="panel panel-default">
            <div class="panel-heading"> 1 - Who's your lead? </div>
            <div class="panel-body">
                <p>
                    <span id="lead-response" class="details text text-success"></span>
                    <a class="btn btn-default" style="float: right" id="lead-trigger">Select lead »</a>
                </p>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="panel panel-default">
            <div class="panel-heading">2 - Billing address</div>
            <div class="panel-body">
                <p>
                    <span id="billing-response" class="details text text-success"></span>
                    <a class="btn btn-default" style="float: right" id="billing-trigger">Select billing address »</a>
                </p>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="panel panel-default">
            <div class="panel-heading">3 - Complete purchase</div>
            <div class="panel-body">
                <p>
                    (Out of scope of this demo ;-))
                    <a class="btn btn-default" style="float: right" id="purchase-trigger">Complete purchase »</a>
                </p>
            </div>
        </div>
    </div>
</div>
@section scripts {
    <script src="http://localhost:3000/uicomposition.js"></script>
    <script defer>
        var policyId = '916B6051-2266-4ED2-A4E4-D3078A27E9A5'; // Generated by client

        window.uiComposition.host.registerComponent({
            serviceComponent: 'person/find-person',
            src: 'http://localhost:3000/selectLead.js',
            targetElementId: 'lead-trigger',
            responseElementId: 'lead-response',
            events: {
                'personSelected': function(args) {
                    $("#lead-response")
                        .text(args.presentation)
                        .fadeIn();
                    $("#lead-trigger")
                        .text("(change)")
                        .removeClass('btn-default')
                        .addClass('btn-link');
                },
                'accept': function(args) {
                    console.log('accept');
                }
            }

        });

        window.uiComposition.host.registerComponent({
            serviceComponent: 'billing/select-billing-address',
            src: 'http://localhost:51372/billingAddress.js',
            targetElementId: 'billing-trigger',
            responseElementId: 'billing-response',
            events: {
                'accept': function(args) {
                    $('#billing-response')
                        .text(args.presentation);
                    $('#billing-trigger')
                        .text("(change)")
                        .removeClass('btn-default')
                        .addClass('btn-link');
                }
            }
        });

        window.uiComposition.listenFor('person/find-person', 'personSelected', function (args) {
            window.uiComposition.host.activateServiceComponent('billing/select-billing-address', {
                addressId: args.addressId,
                legalEntityId: args.personId,
                resourceId: policyId
            });
        });
    </script>
}